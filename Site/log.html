<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--incluindo o bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <title>Kali Racers</title>
    <!--Incluindo o style-->
    <link rel="stylesheet" href="Style.css" />
  </head>

  <body>


    <!--Menu principal-->
    <div class="areal-principal-master">
      <!--Topo-->
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">

            <!--Logo do site com o link para voltar para o início-->
            <a class="navbar-brand" href="main-page.html">
                <img src="Logo1.png" class="img-fluid" style="width: 40%; height: 40%">
            </a>
        </div>
      </nav>
    </div>


    <!--Area do log-->

    <div class="container mt-4"> 
        <h2 class="mb-4" style="color:white;">Logs do Sistema</h2>
    
        <table id="tabela" class="table table-dark table-striped table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th> ID do usuário</th>
                    <th>Ação</th>
                    <th>Detalhes</th>
                    <th>Data/Hora</th>
                </tr>
            </thead>
            <tbody></tbody> <!-- ADICIONADO -->
        </table>
    
        <script>
        async function carregarLog() {
            const response = await fetch("listarlog.php");
            const dados = await response.json();
    
            const tbody = document.querySelector("#tabela tbody");
            tbody.innerHTML = "";
    
            dados.forEach((item) => {
                const tr = document.createElement("tr");
    
                tr.innerHTML = `
                    <td>${item.logid}</td>
                    <td>${item.id}</td>
                    <td>${item.action}</td>
                    <td>${item.details ?? '-'}</td>
                    <td>${item.created_at}</td>
                `;
    
                tbody.appendChild(tr);
            });
        }
    
        carregarLog();
        </script>

        <!--VOLTAR PARA O PAINEL MASTER-->
        <button onclick="voltarmaster()" style="margin-left:1%; margin-top:2%; background-color: white; font-size:120%; font-weight: bold;">Voltar</button>



        <!--GERAR O PDF-->
        <button onclick="gerarPDF()" class="btn btn-primary">Exportar PDF</button>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

        <script>
            async function gerarPDF() {
                const { jsPDF } = window.jspdf;
                const tabela = document.querySelector("#tabela");

                const canvas = await html2canvas(tabela);
                const imgData = canvas.toDataURL('image/png');

                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 190;
                const imgHeight = canvas.height * imgWidth / canvas.width;

                pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                pdf.save("logs.pdf");
            }
        </script>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="JS.js"></script>
  </body>

  <script src="JS.js"></script>
</html>
